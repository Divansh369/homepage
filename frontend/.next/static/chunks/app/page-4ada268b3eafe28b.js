(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1003:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>k});var n=a(5155),s=a(2115),r=a(6874),o=a.n(r),c=a(5028),i=a(6352),l=a(5143),d=a(402),h=a(6766),u=a(8266),p=a(3717),j=a(2525),m=a(9964),b=a(4631),g=a(9629),f=a(7265);function x(e){let{isAuthenticated:t,project:a,isRunning:s,isStarting:r,isEditMode:c,handleStartProject:i,handleStopProject:l,handleOpenProject:x,handleDeleteProject:v}=e,{attributes:S,listeners:N,setNodeRef:P,transform:y,transition:w,isDragging:k}=(0,d.gl)({id:a.id,disabled:!c}),E={transform:u.Ks.Transform.toString(y),transition:w,opacity:k?.8:1,zIndex:k?10:"auto",cursor:c?"grab":"default"},_=c?N:void 0;return(0,n.jsxs)("div",{ref:P,style:E,...S,..._,className:"project-card ".concat(k?"dragging":""),children:[t&&!c&&(0,n.jsxs)("div",{className:"card-header-actions",children:[(0,n.jsx)(o(),{href:"/edit-project/".concat(a.id),className:"card-icon-button",title:"Edit",children:(0,n.jsx)(p.A,{size:16})}),(0,n.jsx)("button",{onClick:()=>v(a.id,a.project_name),className:"card-icon-button",title:"Delete",children:(0,n.jsx)(j.A,{size:16})})]}),a.icon_path&&!a.icon_path.endsWith("default.png")&&(0,n.jsx)(h.default,{className:"project-icon",src:a.icon_path,alt:"".concat(a.project_name," Icon"),width:50,height:50,priority:!1,unoptimized:!0,crossOrigin:"anonymous",onError:e=>{e.target.style.display="none"}}),(0,n.jsx)("h2",{children:a.project_name}),(0,n.jsx)("p",{className:"project-description",children:a.description||"No description provided."}),(0,n.jsx)("div",{className:"label-icons",children:a.cards.map(e=>(0,n.jsxs)("div",{className:"tooltip",children:[(0,n.jsx)(h.default,{className:"label-icon",src:"/label_icons/".concat(e.label_name,".png"),alt:"".concat(e.label_name," Icon"),width:30,height:30,onError:e=>{e.target.src="/label_icons/default.png"}}),(0,n.jsx)("span",{className:"tooltiptext",children:e.label_name})]},e.label_id))}),(0,n.jsxs)("div",{className:"project-actions",children:[s?(0,n.jsxs)("button",{className:"action-button open-button",onClick:()=>x(a.scheme,a.host,a.port),title:"Open Project",children:[(0,n.jsx)(m.A,{size:16,style:{marginRight:"6px"}})," Open"]}):(0,n.jsx)("button",{className:"action-button",disabled:!0,children:"Not Running"}),t&&(r?(0,n.jsxs)("button",{className:"action-button",disabled:!0,style:{minWidth:"100px"},children:[(0,n.jsx)(b.A,{size:16,className:"spinner"})," Starting..."]}):s?(0,n.jsxs)("button",{className:"action-button stop-button",onClick:()=>l(a.project_name),disabled:c,title:"Stop Project",children:[(0,n.jsx)(g.A,{size:16,style:{marginRight:"6px"}})," Stop"]}):(0,n.jsxs)("button",{className:"action-button start-button",onClick:()=>i(a.project_name),disabled:c,title:"Start Project",children:[(0,n.jsx)(f.A,{size:16,style:{marginRight:"6px"}})," Start"]}))]}),(0,n.jsxs)("div",{className:"status-indicator ".concat(s?"running":r?"pending":"stopped"),children:[r?"Pending":s?"Running":"Stopped"," on ",a.host,":",a.port]})]})}function v(e){let{projects:t,setProjects:a,activeProjects:s,startingProjects:r,isEditMode:o,...c}=e,i=(0,l.FR)((0,l.MS)(l.AN,{activationConstraint:{distance:8}}));return(0,n.jsx)(l.Mp,{sensors:i,collisionDetection:l.fp,onDragEnd:e=>{let{active:t,over:n}=e;n&&t.id!==n.id&&a(e=>{let a=e.findIndex(e=>e.id===t.id),s=e.findIndex(e=>e.id===n.id);return(0,d.be)(e,a,s)})},children:(0,n.jsx)(d.gB,{items:t.map(e=>e.id),strategy:d._G,children:(0,n.jsx)("div",{className:"project-cards-container",children:t.map(e=>{var t;let a=null!==(t=s[e.project_name])&&void 0!==t&&t,i=r.has(e.project_name);return(0,n.jsx)(x,{project:e,isRunning:a,isStarting:i,isEditMode:o,...c},e.id)})})})})}var S=a(3626),N=a(435),P=a(1890);let y=(0,c.default)(()=>a.e(183).then(a.bind(a,9183)),{loadableGenerated:{webpack:()=>[9183]},ssr:!1,loading:()=>(0,n.jsx)("div",{className:"filter-select filter-multiselect",style:{minHeight:"38px"},children:"Loading..."})}),w=P.env.NEXT_PUBLIC_WS_URL||"ws://localhost:1024";function k(){let{isAuthenticated:e,checkAuthStatus:t}=(0,S.A)(),{allProjects:a,availableLabels:r,activeProjects:c,startingProjects:l,isLoading:d,error:h,updateStatusFromSocket:u}=(0,S.I)(e=>({allProjects:e.allProjects,availableLabels:e.availableLabels,activeProjects:e.activeProjects,startingProjects:e.startingProjects,isLoading:e.isLoading,error:e.error,updateStatusFromSocket:e.updateStatusFromSocket}),N.x),{fetchInitialData:p,handleStartProject:j,handleStopProject:m,handleDeleteProject:b,saveOrder:g,setAllProjects:f}=(0,S.I)(),[x,P]=(0,s.useState)([]),[k,E]=(0,s.useState)([]),[_,C]=(0,s.useState)([]),[A,O]=(0,s.useState)(""),[L,D]=(0,s.useState)(!1),[T,I]=(0,s.useState)(""),{theme:R,toggleTheme:z}=(0,i.D)(),F=(0,s.useRef)([]);(0,s.useEffect)(()=>{p(),t()},[p,t]),(0,s.useEffect)(()=>{let e=new WebSocket(w);return e.onopen=()=>console.log("✅ WebSocket connection established."),e.onmessage=e=>{try{let t=JSON.parse(e.data);"STATUS_UPDATE"===t.type&&u(t.payload.projectName,t.payload.isRunning)}catch(e){console.error("WS Message Error:",e)}},e.onclose=()=>console.log("❗️ WebSocket connection closed."),e.onerror=e=>console.error("WebSocket error:",e),()=>{1===e.readyState&&e.close()}},[u]);let M=(0,s.useCallback)((e,t,a)=>{window.open("".concat(e,"://").concat(t,":").concat(a),"_blank","noopener,noreferrer")},[]),W=(0,s.useCallback)(()=>{let e=T.trim();e&&/^\d+$/.test(e)&&(M("http","localhost",e),I(""))},[T,M]);(0,s.useEffect)(()=>{let e=new Set(k.map(e=>e.value)),t=new Set(_.map(e=>e.value)),n=A.toLowerCase().trim();P(a.filter(a=>{if(L)return!0;if(!(!n||a.project_name.toLowerCase().includes(n)))return!1;let s=new Set(a.cards.map(e=>String(e.label_id))),r=!(e.size>0)||[...e].some(e=>s.has(e)),o=!(t.size>0)||[...t].some(e=>s.has(e));return r&&o}))},[A,k,_,a,L]);let J=(0,s.useCallback)(e=>e.filter(e=>"language"===e.label_type).map(e=>({value:String(e.id),label:e.name})),[]),U=(0,s.useCallback)(e=>e.filter(e=>"utility"===e.label_type).map(e=>({value:String(e.id),label:e.name})),[]);return(0,n.jsxs)("div",{className:"container ".concat(R),children:[(0,n.jsxs)("nav",{className:"top-navbar",children:[(0,n.jsxs)("div",{className:"navbar-section filters-section",children:[(0,n.jsxs)("div",{className:"filter-container search-container",children:[(0,n.jsx)("label",{children:"Search:"}),(0,n.jsx)("input",{type:"search",className:"navbar-control",value:A,onChange:e=>O(e.target.value),disabled:L})]}),(0,n.jsxs)("div",{className:"filter-container react-select-container",children:[(0,n.jsx)("label",{children:"Language:"}),(0,n.jsx)(y,{options:J(r),isMulti:!0,onChange:e=>E(e),isDisabled:L,className:"react-select-instance",classNamePrefix:"react-select"})]}),(0,n.jsxs)("div",{className:"filter-container react-select-container",children:[(0,n.jsx)("label",{children:"Utility:"}),(0,n.jsx)(y,{options:U(r),isMulti:!0,onChange:e=>C(e),isDisabled:L,className:"react-select-instance",classNamePrefix:"react-select"})]})]}),(0,n.jsx)("div",{className:"navbar-section custom-port-section",children:(0,n.jsxs)("div",{className:"filter-container custom-port-opener",children:[(0,n.jsx)("label",{children:"Open Port:"}),(0,n.jsx)("input",{type:"text",className:"custom-port-input navbar-control",value:T,onChange:e=>I(e.target.value)}),(0,n.jsx)("button",{onClick:W,className:"action-button open-custom-button",children:"\uD83D\uDD17 Open"})]})}),(0,n.jsx)("div",{className:"navbar-section add-buttons-section",children:e&&(L?(0,n.jsxs)(n.Fragment,{children:[" ",(0,n.jsx)("button",{onClick:()=>{g(x.map(e=>e.id),x),D(!1)},className:"action-button start-button",children:"Save Order"})," ",(0,n.jsx)("button",{onClick:()=>{f(F.current),D(!1)},className:"action-button stop-button",children:"Cancel"})," "]}):(0,n.jsxs)(n.Fragment,{children:[" ",(0,n.jsx)(o(),{href:"/admin",className:"action-button nav-edit-button",style:{backgroundColor:"#6f42c1",borderColor:"#6f42c1",color:"white"},children:"Admin Panel"})," ",(0,n.jsx)("button",{onClick:()=>{F.current=[...a],D(!0)},className:"action-button nav-edit-button",children:"Edit Layout"})," ",(0,n.jsx)(o(),{href:"/add-project",className:"action-button nav-add-button",children:"Add Project"})," "]}))}),(0,n.jsxs)("button",{onClick:z,className:"theme-toggle-button-nav",children:[" ","dark"===R?"\uD83C\uDF19":"☀️"," "]})]}),(0,n.jsxs)("main",{className:"main-content",children:[(0,n.jsx)("h1",{className:"projects-header",children:"PROJECT DASHBOARD"}),d&&(0,n.jsx)("p",{className:"loading-indicator",children:"Loading..."}),h&&(0,n.jsx)("p",{className:"error-message",children:h}),!d&&(0,n.jsx)(v,{isAuthenticated:null!=e&&e,projects:x,setProjects:P,activeProjects:c,startingProjects:l,isEditMode:L,handleStartProject:j,handleStopProject:m,handleOpenProject:M,handleDeleteProject:b})]})]})}},3626:(e,t,a)=>{"use strict";a.d(t,{A:()=>r,I:()=>o});var n=a(8693),s=a(435);let r=()=>o(e=>({isAuthenticated:e.isAuthenticated,checkAuthStatus:e.checkAuthStatus}),s.x),o=(0,n.vt)((e,t)=>({isAuthenticated:null,allProjects:[],availableLabels:[],activeProjects:{},startingProjects:new Set,isLoading:!0,error:null,checkAuthStatus:async()=>{try{let t=await fetch("/api/auth/status");if(!t.ok)throw Error("Auth check request failed");let a=await t.json();e({isAuthenticated:a.isAuthenticated})}catch(t){console.error("Auth check failed:",t),e({isAuthenticated:!1})}},logout:async()=>{try{await fetch("/api/logout",{method:"POST"})}catch(e){console.error("Logout failed:",e)}finally{e({isAuthenticated:!1})}},fetchInitialData:async()=>{e({isLoading:!0,error:null});try{let[t,a]=await Promise.all([fetch("/api/projects"),fetch("/api/labels")]);if(!t.ok)throw Error("Failed to fetch projects");if(!a.ok)throw Error("Failed to fetch labels");let n=await t.json(),s=await a.json(),r={};if(n.length>0){let e=n.map(e=>fetch("/api/check-project",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({port:e.port})}).then(e=>e.json()).then(t=>({name:e.project_name,running:t.running})).catch(()=>({name:e.project_name,running:!1})));(await Promise.all(e)).forEach(e=>{r[e.name]=e.running})}e({allProjects:n,availableLabels:s,activeProjects:r,isLoading:!1})}catch(t){e({error:t.message,isLoading:!1})}},handleStartProject:async a=>{let{startingProjects:n,activeProjects:s}=t();if(!n.has(a)&&!s[a]){e({startingProjects:new Set(n).add(a)});try{let e=await fetch("/api/start-project",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectName:a})});if(!e.ok)throw Error(await e.text())}catch(t){console.error("Error starting project:",t),e(e=>({error:"Failed to start ".concat(a),startingProjects:new Set([...e.startingProjects].filter(e=>e!==a))}))}}},handleStopProject:async e=>{try{await fetch("/api/stop-project",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectName:e})})}catch(e){console.error("Error stopping project:",e)}},handleDeleteProject:async(t,a)=>{if(window.confirm('Are you sure you want to delete "'.concat(a,'"? This cannot be undone.')))try{let a=await fetch("/api/projects/".concat(t),{method:"DELETE"});if(!a.ok)throw Error((await a.json()).error||"Delete failed");e(e=>({allProjects:e.allProjects.filter(e=>e.id!==t)}))}catch(e){console.error("Error deleting project:",e)}},saveOrder:async(a,n)=>{let s=t().allProjects;e({allProjects:n});try{let e=await fetch("/api/projects/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderedIds:a})});if(!e.ok)throw Error((await e.json()).error||"Save order failed")}catch(t){console.error("Error saving order:",t),e({allProjects:s})}},setAllProjects:t=>e({allProjects:t}),updateStatusFromSocket:(t,a)=>{e(e=>({activeProjects:{...e.activeProjects,[t]:a},startingProjects:new Set([...e.startingProjects].filter(e=>e!==t))}))}}))},6352:(e,t,a)=>{"use strict";a.d(t,{D:()=>c,N:()=>o});var n=a(5155),s=a(2115);let r=(0,s.createContext)(void 0),o=e=>{let{children:t}=e,[a,o]=(0,s.useState)("light");(0,s.useEffect)(()=>{let e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches,a=e||(t?"dark":"light");o(a),document.documentElement.setAttribute("data-theme",a)},[]);let c=()=>{o(e=>{let t="light"===e?"dark":"light";return localStorage.setItem("theme",t),document.documentElement.setAttribute("data-theme",t),t})},i=(0,s.useMemo)(()=>({theme:a,toggleTheme:c}),[a]);return(0,n.jsx)(r.Provider,{value:i,children:t})},c=()=>{let e=(0,s.useContext)(r);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},9241:(e,t,a)=>{Promise.resolve().then(a.bind(a,1003))}},e=>{var t=t=>e(e.s=t);e.O(0,[874,701,988,441,684,358],()=>t(9241)),_N_E=e.O()}]);